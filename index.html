<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TitanGraph v13 | Robust Edition</title>
    
    <!-- LIBRARIES -->
    <script src="//unpkg.com/three"></script>
    <script src="//unpkg.com/three-spritetext"></script>
    <script src="//unpkg.com/force-graph"></script>
    <script src="//unpkg.com/3d-force-graph"></script>
    
    <!-- ICONS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #050505;
            --panel: #111;
            --border: #333;
            --accent: #00f2ff;
            --text: #eee;
            --muted: #777;
            --danger: #ff4444;
            --success: #00ff9d;
            --font-ui: 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        * { box-sizing: border-box; outline: none; user-select: none; }
        body { margin: 0; overflow: hidden; background: var(--bg); color: var(--text); font-family: var(--font-ui); font-size: 13px; }

        /* GRID LAYOUT */
        #app { display: grid; grid-template-columns: 60px 1fr 350px; grid-template-rows: 50px 1fr 200px; height: 100vh; width: 100vw; }
        
        /* HEADER */
        header { grid-column: 1 / -1; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 100; }
        .brand { font-family: var(--font-mono); font-weight: 700; color: var(--accent); font-size: 1.2rem; }
        .tools { display: flex; gap: 10px; }

        /* TOOLBAR */
        #toolbar { grid-column: 1; grid-row: 2 / -1; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 15px; z-index: 90; }
        .t-btn { width: 40px; height: 40px; border-radius: 8px; background: transparent; border: 1px solid transparent; color: var(--muted); cursor: pointer; display: grid; place-items: center; font-size: 1.1rem; transition: 0.2s; }
        .t-btn:hover { color: var(--text); background: #222; }
        .t-btn.active { background: rgba(0, 242, 255, 0.1); color: var(--accent); border-color: var(--accent); }

        /* VIEWPORT */
        #viewport { grid-column: 2; grid-row: 2; position: relative; overflow: hidden; background: #000; }
        #graph-canvas { width: 100%; height: 100%; }

        /* OVERLAYS */
        .overlay { position: absolute; background: rgba(15, 17, 21, 0.95); border: 1px solid var(--border); border-radius: 6px; padding: 10px; z-index: 10; }
        #search { top: 20px; left: 20px; display: flex; gap: 10px; width: 300px; }
        #search input { background: transparent; border: none; color: white; width: 100%; font-family: var(--font-mono); }
        #stats { top: 20px; right: 20px; font-size: 0.8rem; color: var(--muted); text-align: right; }
        #zoom { bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 5px; }
        .z-btn { width: 30px; height: 30px; background: var(--panel); border: 1px solid var(--border); color: var(--text); cursor: pointer; border-radius: 4px; }

        /* INSPECTOR */
        #inspector { grid-column: 3; grid-row: 2 / -1; background: var(--panel); border-left: 1px solid var(--border); display: flex; flex-direction: column; overflow: hidden; z-index: 90; }
        .p-head { padding: 15px; border-bottom: 1px solid var(--border); font-weight: 600; color: var(--accent); display: flex; justify-content: space-between; align-items: center; }
        .p-body { padding: 0; overflow-y: auto; flex: 1; }
        .p-sec { padding: 15px; border-bottom: 1px solid var(--border); }
        .form-row { margin-bottom: 10px; }
        .form-row label { display: block; font-size: 0.7rem; color: var(--muted); margin-bottom: 4px; }
        .form-row input, .form-row select { width: 100%; background: #050505; border: 1px solid var(--border); color: var(--text); padding: 8px; border-radius: 4px; font-family: var(--font-mono); }
        .json-box { background: #050505; padding: 10px; border-radius: 4px; border: 1px solid var(--border); font-family: var(--font-mono); font-size: 0.75rem; color: #a8b2d1; overflow: auto; max-height: 300px; white-space: pre-wrap; }

        /* LOGS */
        #logs { grid-column: 2; grid-row: 3; background: #000; border-top: 1px solid var(--accent); display: flex; flex-direction: column; font-family: var(--font-mono); z-index: 80; }
        .l-bar { height: 35px; background: var(--panel); border-bottom: 1px solid #222; display: flex; align-items: center; justify-content: space-between; padding: 0 10px; cursor: pointer; }
        #l-cont { flex: 1; overflow-y: auto; padding: 10px; font-size: 0.8rem; color: #ccc; }
        .l-ent { margin-bottom: 4px; display: flex; gap: 10px; border-bottom: 1px solid #111; padding-bottom: 2px; }
        .l-ts { color: #555; min-width: 70px; }
        .l-inf { color: var(--accent); } .l-err { color: var(--danger); } .l-suc { color: var(--success); }

        /* UTILS */
        .btn { background: var(--accent); color: #000; border: none; padding: 6px 14px; border-radius: 4px; cursor: pointer; font-weight: 700; font-size: 0.8rem; display: inline-flex; align-items: center; gap: 8px; }
        .btn:hover { filter: brightness(1.1); }
        .btn-sec { background: transparent; border: 1px solid var(--border); color: var(--muted); }
        .btn-sec:hover { border-color: var(--text); color: var(--text); }

        /* CONTEXT MENU */
        #ctx { position: fixed; display: none; background: var(--panel); border: 1px solid var(--accent); box-shadow: 0 5px 20px rgba(0,0,0,0.9); z-index: 99999; min-width: 200px; border-radius: 4px; }
        .ctx-i { padding: 10px 15px; cursor: pointer; font-size: 0.85rem; display: flex; gap: 10px; align-items: center; color: var(--text); }
        .ctx-i:hover { background: var(--accent); color: #000; }
        .ctx-div { height: 1px; background: var(--border); margin: 2px 0; }
    </style>
</head>
<body>

<div id="app">
    <header>
        <div class="brand"><i class="fas fa-project-diagram"></i> TITAN v13</div>
        <div class="tools">
            <button class="btn btn-sec" onclick="App.undo()"><i class="fas fa-undo"></i></button>
            <button class="btn btn-sec" onclick="App.redo()"><i class="fas fa-redo"></i></button>
            <div style="width:1px; background:var(--border); margin:0 5px"></div>
            <button class="btn btn-sec" onclick="IO.export()">JSON</button>
            <button class="btn" onclick="document.getElementById('f-in').click()">Import</button>
            <input type="file" id="f-in" hidden onchange="IO.import(this)">
        </div>
    </header>

    <div id="toolbar">
        <div class="t-btn active" id="m-2d" onclick="Graph.setMode('2D')" title="2D Mode"><i class="fas fa-circle-nodes"></i></div>
        <div class="t-btn" id="m-3d" onclick="Graph.setMode('3D')" title="3D Mode"><i class="fas fa-cube"></i></div>
        <div style="width:20px; height:1px; background:var(--border)"></div>
        <div class="t-btn active" id="t-move" onclick="Tools.set('move')" title="Move Tool"><i class="fas fa-mouse-pointer"></i></div>
        <div class="t-btn" id="t-link" onclick="Tools.set('link')" title="Link Tool (Drag to Connect)"><i class="fas fa-link"></i></div>
        <div class="t-btn" onclick="Graph.addManual()" title="Add Node"><i class="fas fa-plus"></i></div>
        <div style="width:20px; height:1px; background:var(--border)"></div>
        <div class="t-btn active" id="t-phys" onclick="Graph.togglePhysics()" title="Toggle Physics"><i class="fas fa-anchor"></i></div>
        <div class="t-btn" onclick="Graph.fit()" title="Fit View"><i class="fas fa-compress"></i></div>
    </div>

    <div id="viewport">
        <div id="graph-canvas"></div>
        <div id="search" class="overlay">
            <i class="fas fa-search" style="color:var(--muted)"></i>
            <input id="s-in" placeholder="Search (Ctrl+K)..." oninput="Graph.search(this.value)">
        </div>
        <div id="stats" class="overlay">
            <div>Nodes: <span id="st-n" style="color:var(--accent)">0</span></div>
            <div>Links: <span id="st-l" style="color:var(--accent)">0</span></div>
            <div style="margin-top:5px; border-top:1px solid #333; padding-top:5px; color:#fff" id="st-sel">None</div>
        </div>
        <div id="zoom">
            <button class="z-btn" onclick="Graph.zoom(1)"><i class="fas fa-plus"></i></button>
            <button class="z-btn" onclick="Graph.zoom(-1)"><i class="fas fa-minus"></i></button>
        </div>
    </div>

    <div id="inspector">
        <div class="p-head">
            <span>Inspector</span>
            <button class="btn btn-sec" style="padding:2px 6px" onclick="UI.toggleInsp()"><i class="fas fa-times"></i></button>
        </div>
        <div class="p-body" id="p-cont">
            <div style="padding:40px; text-align:center; color:var(--muted)">Select an entity</div>
        </div>
    </div>

    <div id="logs">
        <div class="l-bar" onclick="UI.toggleLogs()">
            <div style="display:flex; align-items:center; gap:10px"><i class="fas fa-terminal" style="color:var(--accent)"></i> <span id="l-stat">Ready.</span></div>
            <div style="display:flex; gap:5px">
                <button class="btn btn-sec" style="padding:2px 6px; font-size:0.7rem" onclick="event.stopPropagation(); Logger.copy()">COPY</button>
                <button class="btn btn-sec" style="padding:2px 6px; font-size:0.7rem" onclick="event.stopPropagation(); Logger.clear()">CLEAR</button>
            </div>
        </div>
        <div id="l-cont"></div>
    </div>
</div>

<div id="ctx">
    <div class="ctx-i" onclick="Transforms.run('dns')"><i class="fas fa-globe"></i> Resolve DNS</div>
    <div class="ctx-i" onclick="Transforms.run('whois')"><i class="fas fa-id-card"></i> WHOIS</div>
    <div class="ctx-i" onclick="Transforms.run('geoip')"><i class="fas fa-map-marker-alt"></i> GeoIP</div>
    <div class="ctx-div"></div>
    <div class="ctx-i" onclick="Graph.delSel()"><i class="fas fa-trash" style="color:var(--danger)"></i> Delete</div>
</div>

<script>
/**
 * TITAN GRAPH v13
 * Robust Core Edition
 */

const Config = {
    colors: { domain: '#00f2ff', ip: '#00ff9d', person: '#ffcc00', location: '#ff00ff', default: '#8395a7' },
    icons: { domain: '\uf0ac', ip: '\uf233', person: '\uf007', location: '\uf3c5', default: '\uf128' }
};

const Utils = {
    uuid: () => 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => { const r = Math.random()*16|0, v = c=='x'?r:(r&0x3|0x8); return v.toString(16); }),
    copy: o => JSON.parse(JSON.stringify(o))
};

// --- STATE ---
const Store = {
    state: { nodes: [], links: [] },
    history: [], hIdx: -1,

    init() {
        const s = localStorage.getItem('titan_v13');
        if(s) { try { this.state = JSON.parse(s); Logger.log("Session restored.", "suc"); } catch(e){ this.reset(); } } 
        else this.reset();
        this.save();
    },
    reset() { this.state = { nodes: [{id:Utils.uuid(), label:'Start', type:'default', x:0, y:0, val:1}], links:[] }; },
    
    save() {
        if(this.hIdx < this.history.length-1) this.history = this.history.slice(0, this.hIdx+1);
        this.history.push(Utils.copy(this.state));
        if(this.history.length>50) this.history.shift(); else this.hIdx++;
        localStorage.setItem('titan_v13', JSON.stringify(this.state));
        UI.stats();
    },
    undo() { if(this.hIdx>0) { this.hIdx--; this.state = Utils.copy(this.history[this.hIdx]); Graph.refresh(); Logger.log("Undo"); } },
    redo() { if(this.hIdx<this.history.length-1) { this.hIdx++; this.state = Utils.copy(this.history[this.hIdx]); Graph.refresh(); Logger.log("Redo"); } },

    addNode(d) {
        const n = { id:Utils.uuid(), label:d.label, type:d.type||'default', val:1, meta:d.meta||{}, x:d.x||0, y:d.y||0 };
        this.state.nodes.push(n);
        this.save();
        return n;
    },
    addLink(s, t) {
        if(s===t) return;
        const ex = this.state.links.find(l => (l.source.id===s && l.target.id===t) || (l.source===s && l.target===t));
        if(!ex) {
            this.state.links.push({source:s, target:t});
            this.save();
            Graph.refresh();
        }
    },
    updateNode(id, up) { const n = this.state.nodes.find(x=>x.id===id); if(n) { Object.assign(n, up); this.save(); Graph.refresh(); } },
    delNode(id) {
        this.state.nodes = this.state.nodes.filter(n=>n.id!==id);
        this.state.links = this.state.links.filter(l=>l.source.id!==id && l.target.id!==id && l.source!==id && l.target!==id);
        this.save(); Graph.refresh();
    }
};

// --- GRAPH ---
const Graph = {
    instance: null, mode: '2D', selected: null, physics: true,
    hoverNode: null, dragOrigin: null,

    init() {
        this.render();
        window.onresize = () => { if(this.instance) this.instance.width(document.getElementById('graph-canvas').clientWidth).height(document.getElementById('graph-canvas').clientHeight); };
        document.onclick = () => document.getElementById('ctx').style.display='none';
    },

    setMode(m) {
        if(this.mode===m) return;
        this.mode = m;
        document.getElementById('m-2d').classList.toggle('active', m==='2D');
        document.getElementById('m-3d').classList.toggle('active', m==='3D');
        document.getElementById('graph-canvas').innerHTML = '';
        this.instance = null;
        setTimeout(() => this.render(), 50);
    },

    togglePhysics() {
        this.physics = !this.physics;
        document.getElementById('t-phys').classList.toggle('active', this.physics);
        if(!this.physics) {
            Store.state.nodes.forEach(n => { n.fx = null; n.fy = null; });
            if(this.instance) this.instance.d3ReheatSimulation();
            Logger.log("Physics: Flow");
        } else {
            Logger.log("Physics: Steadfast");
        }
    },

    render() {
        const el = document.getElementById('graph-canvas');
        const w = el.clientWidth, h = el.clientHeight;

        if(this.mode === '2D') {
            this.instance = ForceGraph()(el)
                .width(w).height(h).backgroundColor('#000')
                .graphData(Store.state)
                .nodeLabel('label')
                .nodeColor(n => Config.colors[n.type] || Config.colors.default)
                .linkColor(() => '#333')
                .linkWidth(2).linkDirectionalArrowLength(4).linkDirectionalArrowRelPos(1)
                .d3AlphaDecay(0.05) // Reduce jitter
                .d3VelocityDecay(0.4) // Increase friction
                .onNodeHover(n => { this.hoverNode = n; el.style.cursor = n ? 'pointer' : (Tools.cur==='link'?'crosshair':'default'); })
                .nodeCanvasObject((n, ctx, k) => {
                    const r = 6;
                    if(n===this.selected) { ctx.beginPath(); ctx.arc(n.x, n.y, r*1.8, 0, 2*Math.PI); ctx.fillStyle='rgba(0,242,255,0.3)'; ctx.fill(); }
                    if(Tools.cur==='link' && this.hoverNode===n && this.dragOrigin && this.dragOrigin.id !== n.id) {
                        ctx.beginPath(); ctx.arc(n.x, n.y, r*2.5, 0, 2*Math.PI); ctx.strokeStyle='#00f2ff'; ctx.lineWidth=2/k; ctx.stroke();
                    }
                    ctx.beginPath(); ctx.arc(n.x, n.y, r, 0, 2*Math.PI); ctx.fillStyle=Config.colors[n.type]||'#888'; ctx.fill();
                    ctx.font=`${4}px "Font Awesome 6 Free"`; ctx.fillStyle='#000'; ctx.textAlign='center'; ctx.textBaseline='middle'; 
                    ctx.fillText(Config.icons[n.type]||'?', n.x, n.y);
                    ctx.font=`${12/k}px monospace`; ctx.fillStyle='#eee'; ctx.fillText(n.label, n.x, n.y+r+(12/k));
                })
                .onNodeDragStart(node => {
                    this.dragOrigin = { id: node.id, x: node.x, y: node.y, fx: node.fx, fy: node.fy };
                })
                .onNodeDragEnd(node => {
                    if (Tools.cur === 'link') {
                        if (this.hoverNode && this.hoverNode.id !== node.id) {
                            Store.addLink(node.id, this.hoverNode.id);
                            Logger.log(`Linked ${node.label} -> ${this.hoverNode.label}`, "suc");
                        }
                        // Snap back
                        node.x = this.dragOrigin.x; node.y = this.dragOrigin.y;
                        node.fx = this.dragOrigin.fx; node.fy = this.dragOrigin.fy;
                    } else {
                        if (this.physics) { node.fx = node.x; node.fy = node.y; }
                    }
                    this.dragOrigin = null;
                })
                .onRenderFramePost((ctx, k) => {
                    if (Tools.cur === 'link' && this.dragOrigin) {
                        const n = Store.state.nodes.find(x => x.id === this.dragOrigin.id);
                        if(n) {
                            ctx.beginPath(); ctx.moveTo(this.dragOrigin.x, this.dragOrigin.y); ctx.lineTo(n.x, n.y);
                            ctx.strokeStyle = '#ffff00'; ctx.lineWidth = 2/k; ctx.setLineDash([4, 2]); ctx.stroke(); ctx.setLineDash([]);
                        }
                    }
                })
                .onNodeClick(n => { this.selected = n; UI.insp(n); })
                .onNodeRightClick((n, e) => {
                    this.selected = n; UI.insp(n);
                    const m = document.getElementById('ctx');
                    m.style.left = e.clientX+'px'; m.style.top = e.clientY+'px'; m.style.display='block';
                })
                .onBackgroundClick(() => { this.selected = null; UI.clear(); });

        } else {
            // 3D
            this.instance = ForceGraph3D()(el)
                .width(w).height(h).backgroundColor('#000')
                .graphData(Store.state)
                .nodeColor(n => Config.colors[n.type] || '#888')
                .nodeThreeObject(n => {
                    const s = new SpriteText(n.label); s.color = n===this.selected?'#00f2ff':'#eee'; s.textHeight=8; return s;
                })
                .onNodeClick(n => { this.selected = n; UI.insp(n); })
                .onNodeRightClick((n, e) => {
                    this.selected = n; UI.insp(n);
                })
                .onNodeDragEnd(n => { if(this.physics){ n.fx=n.x; n.fy=n.y; n.fz=n.z; } });
        }
    },

    refresh() { 
        const data = { nodes: Store.state.nodes.map(n=>({...n})), links: Store.state.links.map(l=>({...l})) };
        this.instance.graphData(data); 
    },

    addManual() {
        const l = prompt("Label:");
        if(l) {
            // Failsafe: Add at 0,0 if calculation fails
            let x=0, y=0;
            if(this.instance && this.mode==='2D') {
                try {
                    const c = this.instance.screen2GraphCoords(this.instance.width()/2, this.instance.height()/2);
                    if(c) { x = c.x; y = c.y; }
                } catch(e) {}
            }
            Store.addNode({label:l, x:x, y:y});
            Graph.refresh();
            Logger.log(`Added: ${l}`, "suc");
        }
    },
    delSel() { if(this.selected) { Store.delNode(this.selected.id); this.selected=null; UI.clear(); } },
    search(q) {
        if(!q) return;
        const n = Store.state.nodes.find(x=>x.label.toLowerCase().includes(q.toLowerCase()));
        if(n) {
            this.selected = n; UI.insp(n);
            if(this.mode==='2D') { this.instance.centerAt(n.x, n.y, 1000); this.instance.zoom(6, 2000); }
        }
    },
    fit() { this.instance.zoomToFit(400, 100); },
    zoom(d) {
        if(this.mode==='2D') this.instance.zoom(this.instance.zoom() + d*0.5, 400);
    }
};

// --- TOOLS ---
const Tools = {
    cur: 'move',
    set(t) {
        this.cur = t;
        document.getElementById('t-move').classList.toggle('active', t==='move');
        document.getElementById('t-link').classList.toggle('active', t==='link');
        Logger.log(t==='link' ? "Link Mode: Drag node to target." : "Move Mode.");
    }
};

// --- TRANSFORMS ---
const Transforms = {
    async fetch(u) {
        const p = ['https://api.allorigins.win/raw?url=', 'https://corsproxy.io/?', ''];
        for(const x of p) { try { const r = await fetch(x?x+encodeURIComponent(u):u); if(r.ok) return await r.json(); } catch(e){} }
        throw new Error("Conn Fail");
    },
    async run(t) {
        const n = Graph.selected; if(!n) return;
        document.getElementById('ctx').style.display='none';
        Logger.log(`Running ${t}...`);
        try {
            if(t==='dns') {
                const d = await this.fetch(`https://dns.google/resolve?name=${n.label}&type=A`);
                if(d.Answer) {
                    d.Answer.forEach(r => { if(r.type===1) { const ip = Store.addNode({label:r.data, type:'ip', x:n.x+20, y:n.y+20}); Store.addLink(n.id, ip.id); } });
                    n.meta = {...n.meta, dns:d.Answer}; Logger.log("DNS Resolved", "suc");
                }
            } else if(t==='whois') {
                const u = /^\d/.test(n.label) ? `https://rdap.arin.net/registry/ip/${n.label}` : `https://rdap.org/domain/${n.label}`;
                const d = await this.fetch(u);
                n.meta = {...n.meta, whois:d}; Logger.log("WHOIS Done", "suc");
            } else if(t==='geoip') {
                const d = await this.fetch(`https://ipapi.co/${n.label}/json/`);
                if(d.city) { Store.addLink(n.id, Store.addNode({label:`${d.city}, ${d.country_code}`, type:'location', x:n.x, y:n.y+40}).id); n.meta={...n.meta, geoip:d}; Logger.log("GeoIP Done", "suc"); }
            }
            UI.insp(n);
        } catch(e) { Logger.log(e.message, "err"); }
    }
};

// --- UI ---
const UI = {
    insp(n) {
        const c = document.getElementById('p-cont');
        const json = n.meta ? JSON.stringify(n.meta, null, 2) : "";
        c.innerHTML = `
            <div class="p-sec">
                <div class="form-row"><label>LABEL</label><input value="${n.label}" onchange="Store.updateNode('${n.id}', {label:this.value})"></div>
                <div class="form-row"><label>TYPE</label><select onchange="Store.updateNode('${n.id}', {type:this.value})">${Object.keys(Config.colors).map(k=>`<option value="${k}" ${n.type===k?'selected':''}>${k}</option>`).join('')}</select></div>
            </div>
            <div class="p-sec"><div class="form-row"><label>RAW DATA</label><div class="json-box">${json}</div></div></div>
            <div class="p-sec"><button class="btn" style="background:var(--danger); width:100%" onclick="Graph.delSel()">DELETE</button></div>
        `;
        document.getElementById('st-sel').innerText = n.label;
        document.body.classList.remove('insp-closed');
    },
    clear() { document.getElementById('p-cont').innerHTML='<div style="padding:40px;text-align:center;color:#666">Select entity</div>'; document.getElementById('st-sel').innerText='None'; },
    toggleInsp() { document.body.classList.toggle('insp-closed'); },
    toggleLogs() { document.body.classList.toggle('log-min'); },
    stats() { document.getElementById('st-n').innerText=Store.state.nodes.length; document.getElementById('st-l').innerText=Store.state.links.length; }
};

const Logger = {
    log(m, t='inf') {
        const c = document.getElementById('l-cont');
        const d = document.createElement('div'); d.className='l-ent';
        d.innerHTML = `<span class="l-ts">[${new Date().toLocaleTimeString()}]</span><span class="l-${t}">${m}</span>`;
        c.appendChild(d); c.scrollTop=c.scrollHeight;
        document.getElementById('l-stat').innerHTML = `<span class="l-${t}">${m}</span>`;
    },
    copy() { navigator.clipboard.writeText(document.getElementById('l-cont').innerText); },
    clear() { document.getElementById('l-cont').innerHTML=''; }
};

const IO = {
    export() { Utils.copy(Store.state); const a=document.createElement('a'); a.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(Store.state)); a.download="titan.json"; a.click(); },
    import(el) { const f=el.files[0]; if(f){ const r=new FileReader(); r.onload=e=>{ try{ Store.state=JSON.parse(e.target.result); Store.save(); Graph.refresh(); Logger.log("Imported","suc"); }catch(e){Logger.log("Fail","err");} }; r.readAsText(f); } }
};

const App = { undo:()=>Store.undo(), redo:()=>Store.redo() };

window.onload = () => { Store.init(); Graph.init(); Logger.log("TitanGraph v13 Online", "suc"); 
    document.onkeydown = e => { if(e.ctrlKey&&e.key==='z') App.undo(); if(e.ctrlKey&&e.key==='y') App.redo(); if(e.key==='Delete') Graph.delSel(); };
};
</script>
</body>
</html>
